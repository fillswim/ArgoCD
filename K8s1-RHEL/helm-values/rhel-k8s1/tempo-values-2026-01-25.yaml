global:

  dnsService: kube-dns
  dnsNamespace: kube-system
  clusterDomain: cluster.local.

server:
  grpc_server_max_recv_msg_size: 33554432 # 32MB
  grpc_server_max_send_msg_size: 33554432 # 32MB

storage:
  trace:
    backend: s3
    s3:
      bucket: tempo-traces
      region: us-east-1
      endpoint: minio.minio.svc.cluster.local:9000
      access_key: ${MINIO_USER}
      secret_key: ${MINIO_PASSWORD}
      insecure: true

minio:
  enabled: false

traces:
  otlp:
    http:
      enabled: true
    grpc:
      enabled: false
      # port: 4317

ingress:
  enabled: true
  ingressClassName: "nginx"
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: ca-cluster-issuer
    # nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
  paths:
    distributor:
      - path: /v1/traces
        port: 4318               # это порт distributor service для OTLP/HTTP
  hosts:
    - tempo.fillswim.local
  tls:
    - secretName: tempo-distributed-tls
      hosts:
        - tempo.fillswim.local

ingester:
  replicas: 3
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: MINIO_USER
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_ACCESS_KEY
    - name: MINIO_PASSWORD
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_SECRET_KEY

gateway:
  enabled: true
  replicas: 3

distributor:
  replicas: 3
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: MINIO_USER
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_ACCESS_KEY
    - name: MINIO_PASSWORD
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_SECRET_KEY

compactor:
  replicas: 3
  config:
    compaction:
      block_retention: 48h
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: MINIO_USER
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_ACCESS_KEY
    - name: MINIO_PASSWORD
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_SECRET_KEY

querier:
  replicas: 3
  config:
    frontend_worker:
      grpc_client_config:
        max_recv_msg_size: 33554432 # 32MB
        max_send_msg_size: 33554432 # 32MB
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: MINIO_USER
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_ACCESS_KEY
    - name: MINIO_PASSWORD
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_SECRET_KEY

queryFrontend:
  replicas: 3
  extraArgs:
    - -config.expand-env=true
  extraEnv:
    - name: MINIO_USER
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_ACCESS_KEY
    - name: MINIO_PASSWORD
      valueFrom:
        secretKeyRef:
          name: minio-for-tempo-secret
          key: MINIO_SECRET_KEY

memcached:
  replicas: 3